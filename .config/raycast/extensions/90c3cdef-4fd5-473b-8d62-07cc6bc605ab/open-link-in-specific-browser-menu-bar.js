"use strict";var d=Object.defineProperty;var nt=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var at=Object.prototype.hasOwnProperty;var it=(n,t)=>{for(var e in t)d(n,e,{get:t[e],enumerable:!0})},rt=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of et(t))!at.call(n,a)&&a!==e&&d(n,a,{get:()=>t[a],enumerable:!(i=nt(t,a))||i.enumerable});return n};var pt=n=>rt(d({},"__esModule",{value:!0}),n);var ut={};it(ut,{default:()=>V});module.exports=pt(ut);var r=require("@raycast/api");var l=require("react");var g=require("@raycast/api");var w=require("net"),L=n=>!(n!=null&&String(n).length>0);function P(n){return n.slice(0,7)=="mailto:"&&y(n.slice(7))}function b(n){return/^\w+((.\w+)|(-\w+))@[A-Za-z\d]+((.|-)[A-Za-z\d]+).[A-Za-z\d]+$/.test(n)}var N=/;|,/;function y(n){if(L(n))return!1;let t=n.split(N),e=!0;return t.forEach((i,a)=>{e=e&&(L(i)&&a==t.length-1||b(i))}),e}function O(n){let t=n.split(N),e="";return t.map(i=>{b(i)&&(e=e+i+";")}),"mailto:"+e}function D(n){return/^(http|https|ftp):\/\/((?:[\w-]+\.)+[a-z\d]+)((?:\/[^/?#]*)+)?(\?[^#]+)?(#.+)?$/i.test(n)||(0,w.isIPv4)(n)}var h=(n,t)=>/^https?:\/\//g.test(t)?t:`${n}${encodeURIComponent(t)}`,_=(n,t)=>/^http:\/\//g.test(t)?t:`${n}${t}`;var G=require("net");var f=class{constructor(t="",e="",i=""){this.content=t,this.source=e,this.type=i}setContent(t=""){return this.content=t,this}setSource(t=""){return this.source=t,this}setType(){let t=this.content.trim();if(L(t))this.content="",this.source="",this.type="";else if(P(t))this.content=O(t.slice(7)),this.type="Email";else if(y(t))this.content=O(t),this.type="Email";else if(D(t)){let e;(0,G.isIP)(t)?t=="127.0.0.1"?e="http://www."+t:e=_("http://",t):e=/^https?:\/\//g.test(t)?t:"https://"+t,this.content=e,this.type="URL"}else this.content=t,this.type="Text";return this}},W=async()=>{let n=await g.Clipboard.readText();return typeof n>"u"?"":n},X=()=>{let n=new f;return(0,g.getSelectedText)().then(async t=>L(t)?n.setContent(String(await W())).setSource("Clipboard").setType():n.setContent(t.substring(0,9999)).setSource("Selected").setType()).catch(async()=>n.setContent(String(await W())).setSource("Clipboard").setType()).then(t=>L(t.content)?n.setContent("").setSource("").setType():n).catch(()=>n.setContent("").setSource("").setType())};var u=require("@raycast/api");var o=require("@raycast/api");var k={google:"https://google.com/search?q=",bing:"https://www.bing.com/search?q=",baidu:"https://www.baidu.com/s?wd=",brave:"https://search.brave.com/search?q=",duckduckgo:"https://duckduckgo.com/?q="},A=[{path:"/Applications/Safari.app",type:"Browser",rank:1},{path:"/System/Volumes/Preboot/Cryptexes/App/System/Applications/Safari.app",type:"Browser",rank:1},{path:"/Applications/Google Chrome.app",type:"Browser",rank:2},{path:"/Applications/Microsoft Edge.app",type:"Browser",rank:3},{path:"/Applications/Firefox.app",type:"Browser",rank:4},{path:"/Applications/Opera.app",type:"Browser",rank:5},{path:"/Applications/Vivaldi.app",type:"Browser",rank:6},{path:"/Applications/Brave Browser.app",type:"Browser",rank:7},{path:"/Applications/Orion.app",type:"Browser",rank:8},{path:"/Applications/Arc.app",type:"Browser",rank:9},{path:"/Applications/DuckDuckGo.app",type:"Browser",rank:10},{path:"/Applications/MenubarX.app",type:"Browser",rank:11},{path:"/Applications/SigmaOS.app",type:"Browser",rank:12},{path:"/Applications/Slidepad.app",type:"Browser",rank:13},{path:"/Applications/Min.app",type:"Browser",rank:14},{path:"/System/Applications/Mail.app",type:"Email Client",rank:101},{path:"/Applications/Spark.app",type:"Email Client",rank:102},{path:"/Applications/Microsoft Outlook.app",type:"Email Client",rank:103},{path:"/Applications/Airmail.app",type:"Email Client",rank:104},{path:"/Applications/Mimestream.app",type:"Email Client",rank:105},{path:"/Applications/Edison Mail.app",type:"Email Client",rank:106},{path:"/Applications/Downie 4.app",type:"Other",rank:201},{path:"/Applications/IINA.app",type:"Other",rank:202},{path:"/Applications/Motrix.app",type:"Other",rank:203},{path:"/Applications/Thunder.app",type:"Other",rank:204}];async function F(n,t,e){if(n.type!=""){switch(n.type){case"URL":await(0,o.showHUD)("Open link in "+t.name);break;case"Text":await(0,o.showHUD)("Search text by "+(0,o.getPreferenceValues)().surfEngine+" in "+t.name);break;case"Email":await(0,o.showHUD)("Send e-mail in "+t.name);break}await st(lt(n),t.path),await(0,o.popToRoot)({clearSearchBar:!0})}else e(Date.now())}async function st(n,t){try{t==="/Applications/MenubarX.app"?await(0,o.open)(`menubarx://open/?xurl=${n}&xwidth=375&xheight=667&xbar=1`):await(0,o.open)(n,t)}catch{await(0,o.showHUD)("Error Input!")}}function lt(n){switch(n.type){case"Email":return n.content;case"URL":return n.content;default:{switch((0,o.getPreferenceValues)().surfEngine){case"Google":return h(k.google,n.content);case"Bing":return h(k.bing,n.content);case"Baidu":return h(k.baidu,n.content);case"Brave":return h(k.brave,n.content);case"DuckDuckGo":return h(k.duckduckgo,n.content)}return h(k.google,n.content)}}}async function $(n,t,e){e.map((i,a)=>{if(i.name==t.name)switch(n.type){case"Text":{if(e.filter(c=>c.path!==t.path&&c.rankText>=t.rankText).length==0)break;let s=0;e.forEach(c=>[s=s+c.rankText]),e[a].rankText=Math.floor((e[a].rankText+1-e[a].rankText/s)*100)/100;break}case"Email":{if(e.filter(c=>c.path!==t.path&&c.rankEmail>=t.rankEmail).length==0)break;let s=0;e.forEach(c=>[s=s+c.rankEmail]),e[a].rankEmail=Math.floor((e[a].rankEmail+1-e[a].rankEmail/s)*100)/100;break}case"URL":{if(e.filter(c=>c.path!==t.path&&c.rankURL>=t.rankURL).length==0)break;let s=0;e.forEach(c=>[s=s+c.rankURL]),e[a].rankURL=Math.floor((e[a].rankURL+1-e[a].rankURL/s)*100)/100;break}}}),S(e,n),await o.LocalStorage.setItem("Preferred App",JSON.stringify(e))}function S(n,t){switch((0,o.getPreferenceValues)().sortBy){case"Rank":return n.sort(function(e,i){return mt(t,e,i)});case"Name+":return n.sort(function(e,i){return i.name.toUpperCase()<e.name.toUpperCase()?1:-1});case"Name-":return n.sort(function(e,i){return i.name.toUpperCase()>e.name.toUpperCase()?1:-1});default:return n}}function mt(n,t,e){switch(n.type){case"Email":return e.rankEmail-t.rankEmail;case"URL":return(e.rankURL-t.rankURL)*.75+(e.rankText-t.rankText)*.25;case"Text":return(e.rankText-t.rankText)*.75+(e.rankURL-t.rankURL)*.25;case"":return 0}}var q=n=>{let[t,e]=(0,l.useState)(new f),i=(0,l.useCallback)(async()=>{let a=await X();a.type==""?await(0,u.showToast)(u.Toast.Style.Failure,"Nothing is detected from Selected or Clipboard!"):e(a)},[n]);return(0,l.useEffect)(()=>{i()},[i]),{itemInput:t}},z=(n,t)=>{let[e,i]=(0,l.useState)([]),[a,R]=(0,l.useState)([]),[s,c]=(0,l.useState)([]),[Z,T]=(0,l.useState)(!0),{showBrowser:K,showEmail:Q,showOther:Y}=(0,u.getPreferenceValues)(),U=(0,l.useCallback)(async()=>{T(!0);let j=await(0,u.getApplications)(),x=await u.LocalStorage.getItem("Preferred App"),B=typeof x=="string"?JSON.parse(x):[],v=B.map(p=>p.path),tt=A.map(p=>{switch(p.type){case"Browser":{if(K)return p.path;break}case"Email Client":{if(Q)return p.path;break}case"Other":{if(Y)return p.path;break}}}),I=[],C=[];j.forEach(p=>{let E=tt.indexOf(p.path),M=v.includes(p.path);E!==-1&&!M?I.push({bundleId:p.bundleId,name:p.name,path:p.path,rankText:A[E].rank,rankURL:A[E].rank,rankEmail:A[E].rank}):M||C.push({bundleId:p.bundleId,name:p.name,path:p.path,rankText:1,rankURL:1,rankEmail:1})}),I.sort((p,E)=>p.rankURL-E.rankURL),R(S(B,n)),i(I),c(C),T(!1)},[n,t]);return(0,l.useEffect)(()=>{U()},[U]),{buildInApps:e,customApps:a,otherApps:s,loading:Z}};var m=require("react/jsx-runtime");function V(){let{itemInput:n}=q(0),{buildInApps:t,customApps:e,loading:i}=z(n,0);return(0,m.jsxs)(r.MenuBarExtra,{isLoading:i,tooltip:"Open Link in Specific Browser",icon:{source:{light:"open-link-menu-bar-icon.png",dark:"open-link-menu-bar-icon@dark.png"}},children:[e.length!==0&&(0,m.jsx)(r.MenuBarExtra.Section,{title:"Favorites",children:e.map(a=>(0,m.jsx)(J,{openLinkApplication:a,openLinkApplications:e,itemInput:n,isCustom:!0},a.path))}),t.length!==0&&(0,m.jsx)(r.MenuBarExtra.Section,{title:"Recommended",children:t.map(a=>(0,m.jsx)(J,{openLinkApplication:a,openLinkApplications:e,itemInput:n,isCustom:!1},a.path))}),(0,m.jsx)(r.MenuBarExtra.Section,{children:(0,m.jsx)(r.MenuBarExtra.Item,{title:"Add Favorite App",icon:r.Icon.Star,onAction:()=>{(0,r.launchCommand)({name:"open-link-in-specific-browser",type:r.LaunchType.UserInitiated,context:{foo:"bar"}}).then()},shortcut:{modifiers:["cmd"],key:"s"}})}),(0,m.jsx)(r.MenuBarExtra.Section,{children:(0,m.jsx)(r.MenuBarExtra.Item,{title:"Preferences",icon:r.Icon.Gear,onAction:()=>{(0,r.openCommandPreferences)().then()},shortcut:{modifiers:["cmd"],key:","}})})]})}function J(n){let{openLinkApplication:t,openLinkApplications:e,itemInput:i,isCustom:a}=n;return(0,m.jsx)(r.MenuBarExtra.Item,{title:t.name,icon:{fileIcon:t.path},onAction:async()=>{a&&await $(i,t,e),await F(i,t,()=>null)}})}
